version: "3.9"

services:
  api:
    build:
      context: ./services/pds_ops_api
      dockerfile: Dockerfile
    environment:
      AUTH_USER: ${AUTH_USER:-admin}
      AUTH_PASS: ${AUTH_PASS:-admin}
      AUTH_ROLE: ${AUTH_ROLE:-admin}
      DATABASE_URL: ${DATABASE_URL:-sqlite:///./pds_ops.db}
    volumes:
      - ./services/pds_ops_api:/app
    ports:
      - "8000:8000"

  ui:
    build:
      context: ./ui-web
      dockerfile: Dockerfile
    environment:
      VITE_API_URL: ${VITE_API_URL:-http://localhost:8000}
      VITE_AUTH_USER: ${AUTH_USER:-admin}
      VITE_AUTH_PASS: ${AUTH_PASS:-admin}
    ports:
      - "5173:5173"
    depends_on:
      - api

  mssql:
    image: mcr.microsoft.com/mssql/server:2022-latest
    profiles: ["mssql"]
    environment:
      ACCEPT_EULA: "Y"
      SA_PASSWORD: ${MSSQL_SA_PASSWORD:-YourStrong!Passw0rd}
    ports:
      - "1433:1433"
    volumes:
      - mssql_data:/var/opt/mssql

volumes:
  mssql_data:
